{"version":3,"sources":["app/create_page.cljc"],"mappings":";AAeA,AACA,AAEA,AAAKA,8BAAO,6CAAA,2CAAA,4DAAA,KAAA,sEAAA,2CAAA,qDAAA,GAAA,2DAAA,GAAA,iEAAA,GAAA,yDAAA,GAAA,kDAAA,YAAA,qEAAA,2CAAA,qDAAA,GAAA,qDAAA,GAAA,iEAAA,GAAA,kEAAA,GAAA,wDAAA,GAAA,kDAAA,YAAA,6EAAA,2CAAA,qDAAA,GAAA,iEAAA,GAAA,kDAAA,YAAA,gyBAAA,itBAAA,n0FAACC,04CAegB,4GAAA,IAAA,2CAAA,qDAAA,OAAA,2DAAA,OAAA,iEAAA,mFAAA,0FAAA,yDAAA,mFAAA,iBAAA,kDAAA,ttBAACC,myBACD,4GAAA,IAAA,2CAAA,qDAAA,aAAA,qDAAA,SAAA,iEAAA,mFAAA,kFAAA,iFAAA,kDAAA,poBAACA,wtBACC,4GAAA,IAAA,2CAAA,qDAAA,YAAA,kDAAA,IAAA,iEAAA,mFAAA,iFAAA,yDAAA,mFAAA,noBAACA;AA0DhC,iCAAA,jCAAMC,0EAAWC;AAAjB,AACE,yGAAA,mFAAA,sEAAA,3PAACC,mDAAML,4BAAOM,yOAAgCF;;AAEhD,oCAAA,pCAAMG,gFAAcC;AAApB,AACE,yGAAA,mFAAA,sEAAA,3PAACH,mDAAML,4BAAOM,+OAAmCE;;AACnD,uCAAA,vCAAMC,sFAAiBC;AAAvB,AACE,yGAAA,mFAAA,sEAAA,3PAACL,mDAAML,4BAAOM,qPAAsCI;;AAEtD,mCAAA,nCAAMC,8EAAaC;AAAnB,AACE,yGAAA,mFAAA,sEAAA,3PAACP,mDAAML,4BAAOM,6OAAkCM;;AAElD,wCAAA,xCAAMC,wFAAkBT;AAAxB,AACE,yGAAA,mFAAA,qEAAA,1PAACC,mDAAML,4BAAOM,wOAA+BF;;AAE/C,wCAAA,xCAAMU,wFAAkBC;AAAxB,AACE,yGAAA,mFAAA,qEAAA,1PAACV,mDAAML,4BAAOM,wOAA+BS;;AAC/C,8CAAA,9CAAMC,oGAAwBN;AAA9B,AACE,yGAAA,mFAAA,qEAAA,1PAACL,mDAAML,4BAAOM,oPAAqCI;;AAErD,8CAAA,9CAAMO,oGAAwBC;AAA9B,AACE,yGAAA,mFAAA,qEAAA,1PAACb,mDAAML,4BAAOM,qPAAqCY;;AAErD,yCAAA,zCAAMC,0FAAmBC;AAAzB,AACE,yGAAA,mFAAA,qEAAA,1PAACf,mDAAML,4BAAOM,2OAAgCc;;AAEhD,4CAAA,5CAAMC,gGAAsBjB;AAA5B,AACE,yGAAA,mFAAA,6EAAA,lQAACC,mDAAML,4BAAOM,gPAAmCF;;AAEnD,kDAAA,lDAAMkB,4GAA4BZ;AAAlC,AACE,yGAAA,mFAAA,6EAAA,lQAACL,mDAAML,4BAAOM,4PAAyCI;;AAezD","names":["app.create-page/!state","cljs.core.atom","cljs.core.sorted_map","app.create-page/set-name!","name","cljs.core.swap_BANG_","cljs.core/assoc-in","app.create-page/set-surname!","surname","app.create-page/set-department!","department","app.create-page/set-course!","course","app.create-page/set-course-name!","app.create-page/set-course-code!","code","app.create-page/set-course-department!","app.create-page/set-course-instructor!","instructor","app.create-page/set-course-class!","class","app.create-page/set-instructor-name!","app.create-page/set-instructor-department!"],"sourcesContent":["(ns app.create-page\n  (:require clojure.edn\n            contrib.ednish\n            clojure.string\n            #?(:cljc [reagent.core :as reagent])\n            [contrib.datomic-m #?(:clj :as :cljs :as-alias) d]\n            [hyperfiddle.electric :as e]\n            [hyperfiddle.electric-dom2 :as dom]\n            [hyperfiddle.electric-ui4 :as ui4]\n            [hyperfiddle.history :as history]\n            #?(:clj [datomic.client.api :as dt])\n            [contrib.datomic-m #?(:clj :as :cljs :as-alias) d]\n            #?(:cljc [thereisnodot.reagent-autocomplete.core :as autocomplete])))\n\n\n(e/def conn)\n(e/def db)\n\n(def !state (atom {:selected nil\n                   :stage-student    {:name       \"\"\n                                      :surname    \"\"\n                                      :department \"\"\n                                      :course     \"\"\n                                      :id         0}\n                   :stage-course {:name \"\"\n                                  :code \"\"\n                                  :department \"\"\n                                  :instructor \"\"\n                                  :class \"\"\n                                  :id 0}\n                   :stage-instructor {:name \"\"\n                                      :department \"\"\n                                      :id 0}\n                   :names    (sorted-map 0 {:name \"Emil\", :surname \"Hans\", :department [:department/matematik], :course [\"MAT101\"] :id 0})\n                   :courses  (sorted-map 0 {:name \"Calculus 1\" :code \"MAT101\" :department [:department/matematik :department/fizik] :id 0})\n                   :instructor (sorted-map 0 {:name \"Ali Deniz\" :id 1 :department [:department/fizik] :course [\"MAT101\"]})}))\n\n#?(:clj (defn CreateStudent [id name surname department course db]\n          (dt/transact db {:tx-data [{:student/id         id\n                                      :student/name       (str name \" \" surname)\n                                      :student/department department\n                                      :student/course     course}]})))\n#?(:clj (defn student-next-id [db]\n          (if (empty? (dt/q '[:find (max ?id)\n                              :where [_ :student/id ?id]] db))\n            101\n            (inc (ffirst (dt/q '[:find (max ?id)\n                                 :where [_ :student/id ?id]] db))))))\n\n#?(:clj (defn course-next-id [db]\n          (if (empty? (dt/q '[:find (max ?id)\n                              :where [_ :course/id ?id]] db))\n            201\n            (inc (ffirst (dt/q '[:find (max ?id)\n                                 :where [_ :course/id ?id]] db))))))\n#?(:clj (defn instructor-next-id [db]\n          (if (empty? (dt/q '[:find (max ?id)\n                              :where [_ :instructor/id ?id]] db))\n            301\n            (inc (ffirst (dt/q '[:find (max ?id)\n                                 :where [_ :instructor/id ?id]] db))))))\n\n#?(:clj (defn department-id-finder [dept-string db]\n\n          ;Cikti olarak:\n          ;=> [[:department/id 401] [:department/id 402]]\n          (vector (keyword \"department\" \"id\") (ffirst (dt/q '[:find ?id\n                                                              :in $ ?dept\n                                                              :where [?e :department/name ?dept]\n                                                              [?e :department/id ?id]] db (clojure.string/capitalize dept-string))))\n          #_(map (fn [dept] (vector (keyword \"department\" \"id\") (ffirst (dt/q '[:find ?id\n                                                                                :in $ ?dept\n                                                                                :where [?e :department/name ?dept]\n                                                                                [?e :department/id ?id]] db (clojure.string/capitalize dept))))) (clojure.string/split dept-string #\",\"))))\n\n\n#?(:clj (defn course-id-finder [string-code db]\n          ;Cikti\n          ;=> [[:course/id 201]]\n          (into [] (map (fn [code] (vector (keyword \"course\" \"id\") (ffirst (dt/q '[:find ?id\n                                                                                   :in $ ?code\n                                                                                   :where [?e :course/code ?code]\n                                                                                   [?e :course/id ?id]] db code)))) (clojure.string/split string-code #\",\")))))\n#?(:clj (defn course-department-id-finder [string-dept db]\n          (into [] (map (fn [code] (vector (keyword \"department\" \"id\") (ffirst (dt/q '[:find ?id\n                                                                                       :in $ ?code\n                                                                                       :where [?e :department/name ?code]\n                                                                                       [?e :department/id ?id]] db (clojure.string/capitalize code))))) (clojure.string/split string-dept #\",\")))))\n#?(:clj (defn course-instructor-id-finder [instructor-string db]\n          (into [] (map (fn [instructor] (vector (keyword \"instructor\" \"id\") (ffirst (dt/q '[:find ?id\n                                                                                             :in $ ?instructor\n                                                                                             :where [?e :instructor/name ?instructor]\n                                                                                             [?e :instructor/id ?id]] db instructor)))) (clojure.string/split instructor-string #\",\")))))\n(defn set-name! [name]\n  (swap! !state assoc-in [:stage-student :name] name))\n\n(defn set-surname! [surname]\n  (swap! !state assoc-in [:stage-student :surname] surname))\n(defn set-department! [department]\n  (swap! !state assoc-in [:stage-student :department] department))\n\n(defn set-course! [course]\n  (swap! !state assoc-in [:stage-student :course] course))\n\n(defn set-course-name! [name]\n  (swap! !state assoc-in [:stage-course :name] name))\n\n(defn set-course-code! [code]\n  (swap! !state assoc-in [:stage-course :code] code))\n(defn set-course-department! [department]\n  (swap! !state assoc-in [:stage-course :department] department))\n\n(defn set-course-instructor! [instructor]\n  (swap! !state assoc-in [:stage-course :instructor] instructor))\n\n(defn set-course-class! [class]\n  (swap! !state assoc-in [:stage-course :class] class))\n\n(defn set-instructor-name! [name]\n  (swap! !state assoc-in [:stage-instructor :name] name))\n\n(defn set-instructor-department! [department]\n  (swap! !state assoc-in [:stage-instructor :department] department))\n#?(:clj (defn CreateCourse [id name code department instructor class db]\n          (dt/transact db {:tx-data [{:course/id id\n                                      :course/name name\n                                      :course/code code\n                                      :course/department department\n                                      :course/instructor instructor\n                                      :course/class class}]})\n          db))\n\n#?(:clj (defn CreateInstructor [id name department db]\n          (dt/transact db {:tx-data [{:instructor/id id\n                                      :instructor/name name\n                                      :instructor/department department}]})))\n\n(e/defn CreateData []\n        (e/server\n          (binding [conn @(requiring-resolve 'user/datomic-conn)]\n            (binding [db (dt/db conn)]\n\n              (e/client\n                (dom/div\n                  (dom/h2 (dom/text \"Creating Student Side\"))\n                  (let [state (e/watch !state)]\n                    (let [stage (:stage-student state)]\n                      (dom/span  (dom/text \"Name:\"))\n                      (ui4/input (:name stage) (e/fn [v] (set-name! v)))\n                      (dom/div\n                        (dom/span (dom/text \"Surname:\"))\n                       (ui4/input (:surname stage) (e/fn [v] (set-surname! v))))\n                      (dom/div\n                        (dom/span  (dom/text \"Department:\"))\n                        (e/server (ui4/select (:department stage)\n                                              (e/fn V! [v] (e/client (set-department! v)))\n                                              (e/fn Options [] (for [k (e/server (flatten (dt/q '[:find ?name\n                                                                                                  :where [_ :department/name ?name]] db)))]\n                                                                 k))\n                                              (e/fn OptionsLabel [x] x))))\n\n\n                      (dom/span  (dom/text \"Course:\"))\n                      (ui4/input (:course stage) (e/fn [v] (set-course! v)))\n\n\n                      (dom/div (dom/props\n                                 {:style {:grid-area             \"j\"\n                                          :display               :grid\n                                          :grid-gap              \"0.5rem\"\n                                          :grid-template-columns \"auto auto auto 1fr\"}})\n                               (dom/div (ui4/button (e/fn []\n                                                          (apply (.-log js/console) [1 2])\n\n                                                          (e/server (CreateStudent (student-next-id db) (:name stage) (:surname stage) (department-id-finder (:department stage) db)  (course-id-finder (:course stage) db) conn)))\n\n                                                    (dom/text \"Create Student\")))))))\n                (dom/div\n                  (dom/h2 (dom/text \"Creating Course Side\"))\n\n                  (let [state (e/watch !state)]\n                    (let [stage (:stage-course state)]\n                      (dom/span  (dom/text \"Name:\"))\n                      (ui4/input (:name stage) (e/fn [v] (set-course-name! v)))\n                      (dom/span  (dom/text \"Code:\"))\n                      (ui4/input (:code stage) (e/fn [v] (set-course-code! v)))\n                      (dom/div\n                        (dom/span (dom/text \"Department:\"))\n                       (e/server (ui4/select (:department stage)\n                                             (e/fn V! [v] (e/client (set-course-department! v)))\n                                             (e/fn Options [] (for [k (e/server (flatten (dt/q '[:find ?name\n                                                                                                 :where [_ :department/name ?name]] db)))]\n                                                                k))\n                                             (e/fn OptionsLabel [x] x))))\n                      (dom/span  (dom/text \"Instructor:\"))\n                      (e/server (ui4/select (:instructor stage)\n                                            (e/fn V! [v] (e/client (set-course-instructor! v)))\n                                            (e/fn Options [] (for [k (e/server (flatten (dt/q '[:find ?name\n                                                                                                :where [_ :instructor/name ?name]] db)))]\n                                                               k))\n                                            (e/fn OptionsLabel [x] x)))\n                      (dom/span  (dom/text \"Class:\"))\n                      (ui4/input (:class stage) (e/fn [v] (set-course-class! v)))\n                      (dom/text stage)\n                      (dom/div (dom/props\n                                 {:style {:grid-area             \"j\"\n                                          :display               :grid\n                                          :grid-gap              \"0.5rem\"\n                                          :grid-template-columns \"auto auto auto 1fr\"}})\n                               (dom/div (ui4/button (e/fn []\n\n                                                          (e/server (CreateCourse (course-next-id db) (:name stage) (:code stage) (course-department-id-finder (:department stage) db) (course-instructor-id-finder (:instructor stage) db)  (:class stage) conn)))\n\n                                                    (dom/text \"Create Course\")))))))\n                (dom/div\n                  (dom/h2 (dom/text \"Creating Instructor Side\"))\n                  (let [state (e/watch !state)]\n                    (let [stage (:stage-instructor state)]\n                      (dom/span  (dom/text \"Name:\"))\n                      (ui4/input (:name stage) (e/fn [v] (set-instructor-name! v)))\n                      (dom/span  (dom/text \"Department:\"))\n                      (e/server (ui4/select (:department stage)\n                                            (e/fn V! [v] (e/client (set-instructor-department! v)))\n                                            (e/fn Options [] (for [k (e/server (flatten (dt/q '[:find ?name\n                                                                                                :where [_ :department/name ?name]] db)))]\n                                                               k))\n                                            (e/fn OptionsLabel [x] x)))\n\n                      (dom/div (dom/props\n                                 {:style {:grid-area             \"j\"\n                                          :display               :grid\n                                          :grid-gap              \"0.5rem\"\n                                          :grid-template-columns \"auto auto auto 1fr\"}})\n                               (dom/div (ui4/button (e/fn []\n                                                          (apply (.-log js/console) [1 2])\n\n                                                          (e/server (CreateInstructor (instructor-next-id db) (:name stage) (course-department-id-finder (:department stage) db) conn)))\n\n                                                    (dom/text \"Create Instructor\"))))))))))))\n\n\n\n\n"]}